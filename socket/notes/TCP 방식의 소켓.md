# TCP
TCP 소켓은 3 way hand-shaking 과정을 통해 호스트와 연결을 하고, 신뢰성 있는 통신을 지향하는 소켓이다. TCP의 대표적인 특징은, 순차적인 흐름으로 데이터를 순차적으로 전송하고, 신뢰성이 높다는 특징이 있다. 또한 호스트끼리 1대 1 관계로 연결된다. 

TCP는 UDP 방식에 비해서 신뢰도가 높지만 비교적 전송 속도가 느리고, 소켓의 생성과 연결 과정이 복잡하다.

## TCP 소켓의 연결
TCP 의 3 way hand-shaking 과정은 다음과 같다.
1. 클라이언트가 연결을 원하는 서버 측으로 SYN 패킷을 임의의 seq 넘버와 함께 전송한다.
2. 클라이언트의 SYN 패킷을 수신한 서버는 수신을 완료하였다는 의미로 SYN + ACK 패킷을 클라이언트로 전송한다. 이때 클라이언트에서 전송한 seq + 1의 값을 ack 값으로 설정하여 ACK 패킷과 함께 전송하고, 임의의 seq 값을 SYN 패킷에 같이 전송한다. 그리고 클라이언트 측의 ACK 패킷 답변을 대기한다.
3. 서버의 SYN + ACK 패킷을 수신받은 클라이언트는 수신을 제대로 받았다는 의미로 서버측에서 받은 seq + 1의 값을 ack 값으로 설정하고 클라이언트가 이전에 보낸 seq 값에 1을 더하여 ACK 패킷과 함께 서버로 전송한다.

위 과정들을 완료하면 클라이언트와 서버는 통신을 위해 연결된 상태인 것이다.

## TCP 소켓의 데이터 전송

TCP 소켓을 데이터 전송 과정의 신뢰성을 확보하기 위해서 데이터를 호스트에게 전송 후, 전송 결과를 받아서 제대로 전송 되었는지를 확인한다. 만약 전송 결과가 돌아오지 않는다면, 다시 같은 데이터를 호스트에게 전송한다. TCP 방식의 데이터 송수신 과정은 다음과 같다.

1. 송신자가 SEQ 100 과 500 바이트의 데이터를 수신자에게 전송한다.
2. 수신자는 송신자가 전송한 데이터를 수신한다.
3. 수신자가 데이터를 제대로 받았다는 의미로 ACK 패킷과 SEQ 600 을 전송한다. 이때 SEQ가 600 인 이유는, 송신자가 전송한 SEQ가 100이고, 수신받은 데이터가 500 바이트 이므로, 100-599 바이트의 데이터를 무사히 받았다는 의미로 초기 SEQ + 수신받은 바이트 수 = 600 으로 SEQ 값을 부여해서 전송하는 것이다.
4. TCP는 누적 ACK 방식을 사용하므로, 다음 데이터를 수신자에게 전송할때, 이전에 받은 SEQ 값인 600을 데이터와 함께 보낸다. 즉, 다음 데이터 전송시의 SEQ 값이 600이 되는것이다.

위의 과정에서 만약 ACK 600이 송신자에게 전달되어야 하는데 전달되지 못하고, 그 이후의 데이터에 대한 값인 ACK 900 이 송신자에게 전달되었다면, 송신자는 ACK 600에 해당하는 데이터 전송이 손실 혹은 누락되었다고 가정하고, 재전송을 실시한다.

이렇게 ACK 번호는 단순히 패킷에 붙는 번호가 아닌, 연속적으로 받은 바이트의 다음 번호를 나타내어서 데이터 수신이 제대로 이루어 졌는지 송신자가 알수있도록 하는 기능이있다.