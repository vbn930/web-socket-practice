# epoll의 이벤트 감지 방식
epoll 함수엔 레벨 트리거와 엣지 트리거, 두가지 방식의 이벤트 감지 방법이 있다.

## 레벨 트리거 (Level Trigger)
먼저 레벨 트리거는 입력 버퍼 데이터가 존재하거나, 출력 버퍼에 데이터를 저장하기 위한 공간이 남아있다면 지속해서 해당 이벤트를 등록하는 것이다. 다시말해, 만약 입력 버퍼에 50 바이트의 데이터가 저장되어 있고, 20 바이트의 데이터를 전송한후, 버퍼에 30 바이트가 남았다면, 레벨 트리거 방식에서는 데이터가 모두 전송 될 때 까지 이벤트를 발생시킨다. 또한 출력 버퍼가 비어있는 상태에서 총 100 바이트를 전송해야하는데, 500 바이트만 출력 버퍼에 저장하였다면, 출력 버퍼에 빈 공간이 남았다는 이벤트를 발생시킨다. 이 이벤트를 통해 write 함수를 호출하여 남은 데이터를 전송 할 수 있다.

## 엣지 트리거 (Edge Trigger)
엣지 트리거 방식은 데이터가 수신 혹은 발신 된 최초 한번의 상황에만 이벤트를 발생 시킨다. 만약 데이터가 수신되었는데, 입력 버퍼에 수신할 데이터가 추가로 남아있는 경우에도, 엣지 트리거 방식의 epoll은 이벤트를 발생시키지 않는다. 그렇기 때문에, 데이터가 저장된 입력 버퍼에 남은 모든 데이터를 다 읽어들여야 한다.

### 엣지 트리거와 논블록킹 소켓
엣지 트리거 방식을 사용한 서버에선 논블록킹 소켓을 이용하여 데이터를 처리해야한다. 이벤트가 입출력이 최초로 실행 되었을때, 단 한번만 발생 하기 때문에, 이는 만약 블록킹 소켓으로 엣지 트리거로 발생한 이벤트를 처리한다면, 입력 버퍼가 비었을때, 무제한으로 기다릴 수도 있기 때문이다. 예를 들어 보자면, 만약 엣지 트리거와 블록킹 소켓의 조합으로 서버를 구현하였다고 가정 해보자.

클라이언트가 연속으로 5바이트, 5바이트 총 두번의 데이터를 전송하였다. 엣지 트리거 방식에선 데이터가 전송된 최소에만 이벤트가 발생 하기 때문에 반드시 반복문을 통해 이벤트가 발생한 시점부터 모든 데이터를 버퍼가 비워질 때 까지 입력받아야 한다. 블록킹 소켓으로 5바이트를 받은 다음 반복문을 통해 또 다시 5바이트를 받았다. 이 이후에는 클라이언트의 데이터 전송이 추가적으로 이루어 지지 않는 한, 입력 버퍼는 비어있는 상태인데, 블록킹 소켓은 입력 버퍼가 비어있는 상태라는 것을 알 수 있는 방법이 없다. 즉, 클라이언트가 다음 데이터를 전송 할 때 까지, 혹은 연결을 종료 할 때 까지 무한정 블록킹 되는 상태인것이다.

하지만 논블록킹 소켓을 통해 구현한다면, 만약 소켓이 비어있는 입력 버퍼를 읽는 시도를 한다면, -1을 반환하여 버퍼가 비어있다는 사실을 알수 있기 때문에, 반복문을 빠져나와 다음 이벤트를 처리 할 수 있다.

## 레벨 트리거 vs 엣지 트리거
레벨 트리거는 안정성과 구현의 난이도 측면에서 이점을 가진다. 하지만 엣지 트리거 방식의 이점인 높은 성능과 확장성에 의해 엣지 트리거 방식의 서버가 더 많이 사용된다. 또한 엣지 트리거 방식은 서버가 이벤트의 처리 시점을 조절할수 있다는 것에 큰 이점이 있다. 레벨 트리거 방식의 경우에는 데이터가 남아있다면 계속해서 이벤트가 발생하여, 데이터를 모두 처리해야한다는 단점이 있지만, 엣지 트리거는 데이터의 입출력 시첨에 최초 한번만 이벤트가 발생 하기 때문에 데이터의 처리 시점을 서버가 유연하게 정할 수 있다.